<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Fatemeh Rashidi">
    <meta name="keywords" content="movie, cinema, serial, series, ...">
    <meta name="description" content="movies-connecting to database">

    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="style.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Poppins:wght@200;400;700&display=swap" rel="stylesheet">

    <script src="js/bootstrap.min.js"></script>

    <title>IMDb</title>
</head>
<body>
   <main>
        <div class="container">
            <form action="">
                <label for="" class="form-label">...</label>
                <select name="" id="movies" class="form-select" onchange="display_info(this)">
                </select>
            </form>
                <div id="all_data" class="card" style="visibility: hidden;">
                    <div class="left-col">
                        <img id="image_url" class="img-fluid">
                    </div>
                    <div class="right-col card-body">
                        
                         
                        <div id="title" class="card-title"></div>
                        <div id="year" class="card-text"></div>
                        
                        <div id="genres">


                        </div>
                        
                        <div id="rating-box" class="card-text">
                            <a href="https://www.imdb.com/"><img class="img-fluid" id="logo" src="IMDB_Logo_2016.svg" alt=""></a>
                            <span id="rating"><span id="rate-no" class="bold"></span><span id="ten" style="color: gray;">/10</span></span>
                        </div>
                        <div class="card-text">Rank: <span id="rank" class="bold"></span></div>
                        <div class="card-text" id="running_time_secs"></div>
                        
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item">
                                <div id="plot"></div>
                            </li>
                            <li class="list-group-item">
                                <a href="#" id="director-box"><span class="bold">Directed By</span><span id="directors"></span></a>
                            </li>
                            <li class="list-group-item">
                                <a href="#" id="actors-box"><span class="bold">Stars</span><span id="actors"></span></a>
                            </li>
                            <li class="list-group-item">
                                <div id="release_date"></div>
                            </li>
                        </ul>
                    </div>
                </div>
        </div>
   </main>





    <script>
        var movies;
        
        function display_movie_names() {
            var select = document.getElementById("movies");
            for (var i = 0 ; i < movies.length ; i++) {
                var option = document.createElement("OPTION");
                option.innerHTML = movies[i].title;
                select.appendChild(option);
            }
        }

        function get_index() {
            for (var i ; i < movies.length ; i++) {
                movies[i].id = i + 1;
            }
            return;
        }

        async function read_data(path) {
            var x = await fetch(path);
            var y = await x.text();
            movies = JSON.parse(y);
            // get_index();
            console.log(movies[0].id);
            display_movie_names();
            console.log(movies);
        }

        function display_info(selected_movie) {
            // var movie = selected_movie.selectedOptions[0];

            // var parameters = ["year", "title", "info"];
            // var info = ["directors", "release_date", "rating", "genres", "image_url", "plot", "rank", "running_time_secs", "actors"];
            // for (var i = 0 ; i < parameters.length ; i++) {
            //     if (i < 2) {
            //         document.getElementById(parameters[i]).innerHTML = "";
            //     }
            //     else {
            //         for (var j = 0 ; j < info.length ; j++) {
            //             document.getElementById(parameters[i].)                        
            //         }
            //     }
            // }

            var movie = selected_movie.selectedOptions[0];

            var parameters = ["year", "title", "info"];
            var info = ["directors", "release_date", "rating", "genres", "image_url", "plot", "rank", "running_time_secs", "actors"];

            document.getElementById("title").innerHTML = "";
            document.getElementById("year").innerHTML = "";
            document.getElementById("directors").innerHTML = "";
            document.getElementById("release_date").innerHTML = "";
            document.getElementById("rate-no").innerHTML = "";
            document.getElementById("genres").innerHTML = "";
            document.getElementById("image_url").src = "";
            document.getElementById("plot").innerHTML = "";
            document.getElementById("rank").innerHTML = "";
            document.getElementById("running_time_secs").innerHTML = "";
            document.getElementById("actors").innerHTML = "";


            // make all divs empty befor display info
            // for (var i = 0 ; i < parameters.length ; i++) {
            //     if (parameters[i] == "info") {
            //         for (var j ; j < info.length ; j++) {
            //             if (info[j] != "image_url") {
            //                 document.getElementById(info[j]).innerHTML = "";
            //             }
            //             else {
            //                 document.getElementById("image_url").src = "";
            //             }
            //         }
            //     }
            //     else {
            //         document.getElementById(parameters[i]).innerHTML = "";    
            //     }
            // }

            document.getElementById("title").innerHTML += movie.text;
            
            for (var i = 0 ; i < movies.length ; i++) {
                if (movies[i].title == movie.text) {

                    document.getElementById("year").innerHTML = movies[i].year;
                    document.getElementById("directors").innerHTML = movies[i].info.directors;
                    document.getElementById("release_date").innerHTML = "Release date: " + movies[i].info.release_date.substring(0, 10);
                    if (movies[i].info.rating != null) {

                        document.getElementById("rate-no").innerHTML = String(movies[i].info.rating);
                    }
                    else {
                        document.getElementById("rate-no").innerHTML = "-"
                    }

                    // var genres = document.getElementById("genres").innerHTML = "Genres" + movies[i].info.genres;
                    var genres = document.getElementById("genres");

                    for (var j = 0 ; j < movies[i].info.genres.length ; j++) {
                        var btn = documnet.createElement("button");
                        btn.innerHTML = movies[i].info.genres[j];
                        btn.className = "btn btn-outline-secondary";
                        genres.appendChild(btn);
                        
                    }
                    document.getElementById("image_url").src = movies[i].info.image_url;
                    document.getElementById("plot").innerHTML = movies[i].info.plot;
                    document.getElementById("rank").innerHTML = movies[i].info.rank;
                    if (movies[i].info.running_time_secs != null) {
                        var duration = movies[i].info.running_time_secs;
                        var hours = Math.floor(duration / 3600);
                        var mins = Math.floor((duration % 3600) / 60);
                        var time = String(hours) + "h " + String(mins) + "m";
                        document.getElementById("running_time_secs").innerHTML = time;
                    }
                    document.getElementById("actors").innerHTML = movies[i].info.actors;

                    var tmp = document.getElementById("all_data");
                    tmp.style.visibility = "visible";
                }
            }
            
        }

        var path = "moviedata.json";
        read_data(path);
       
        
    </script>
</body>
</html>